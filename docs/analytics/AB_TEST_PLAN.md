# 问渠 AI 命理咨询 - A/B测试设计方案

> **项目状态**: ✅ 方案设计完成 | 🚧 本地演示环境
> 
> **目标**: 建立科学的实验机制，用数据验证产品假设  
> **原则**: 小步快跑、快速验证、数据驱动

---

## 1. A/B测试方法论

### 1.1 什么是A/B测试？

A/B测试是一种通过对比两个或多个版本的实验方法，用数据验证哪个方案更优。

```
用户流量 → 随机分流 → 方案A (对照组) → 数据收集 → 统计分析 → 决策
         │           → 方案B (实验组) → 数据收集 →
         │
         └→ 核心原则：单一变量、随机分组、统计显著
```

### 1.2 A/B测试流程

```
1. 发现问题 → 2. 提出假设 → 3. 设计实验 → 4. 确定样本 → 
5. 实施实验 → 6. 分析结果 → 7. 决策落地 → 8. 持续监控
```

### 1.3 测试原则

| 原则 | 说明 | 示例 |
|------|------|------|
| **单一变量** | 只改变一个因素 | 只改Prompt，不改UI |
| **随机分组** | 用户随机分配到各组 | 基于user_id哈希分流 |
| **样本充足** | 样本量足够检测差异 | 至少30个转化/组 |
| **统计显著** | p值 < 0.05才认为有效 | 置信度95% |

---

## 2. 实验设计模板

### 2.1 实验设计文档模板

```markdown
## 实验名称
[简洁明了的名称]

## 1. 背景与问题
- 发现了什么问题？
- 当前数据表现如何？

## 2. 假设
- 原假设(H0): [对照组和实验组无差异]
- 备择假设(H1): [实验组优于对照组]

## 3. 实验设计
- 对照组(A): [当前方案]
- 实验组(B): [新方案]
- 分流比例: [如 50:50]

## 4. 核心指标
- 主要指标: [如对话完成率]
- 次要指标: [如响应时间、满意度]
- 护栏指标: [如错误率，不能变差]

## 5. 样本量计算
- 基线转化率: [如60%]
- 预期提升: [如提升10%，到66%]
- 显著性水平: [α = 0.05]
- 统计功效: [1-β = 0.8]
- 所需样本: [计算结果]

## 6. 实验周期
- 开始时间: 
- 预计结束: 
- 最小运行天数: [通常14天]

## 7. 成功标准
- [明确什么情况下认为实验成功]

## 8. 风险与回滚
- 风险: [可能的风险]
- 回滚策略: [如果实验组明显变差，立即切换]
```

---

## 3. 具体实验计划

### 实验1: Prompt优化效果验证

#### 背景
当前Prompt版本(v1.0)用户追问率35%，怀疑是回答深度不够。

#### 假设
- **H0**: v2.0 Prompt与v1.0在追问率上无显著差异
- **H1**: v2.0 Prompt的追问率显著低于v1.0

#### 实验设计
| 组别 | 方案 | 分流比例 |
|------|------|---------|
| A组 (对照) | v1.0基础Prompt | 50% |
| B组 (实验) | v2.0增加思维链Prompt | 50% |

#### 核心指标
- **主要指标**: 追问率 (越低越好)
- **次要指标**: 回答满意度、平均响应时间
- **护栏指标**: 错误率 (不能超过基线5%)

#### 样本量计算
```
基线追问率: 35%
预期追问率: 25% (降低10个百分点)
显著性水平 α: 0.05
统计功效 1-β: 0.8

所需样本: 每组约150人，共300人
```

#### 实验周期
- 开始: 2026-02-10
- 预计结束: 2026-02-24 (14天)
- 或达到样本量提前结束

#### 成功标准
- B组追问率显著低于A组 (p < 0.05)
- 错误率不显著增加
- 满意度评分提升

---

### 实验2: 加载动画效果验证

#### 背景
用户等待AI响应时可能产生焦虑，增加流失。

#### 假设
增加加载动画和进度提示能降低等待流失率。

#### 实验设计
| 组别 | 方案 |
|------|------|
| A组 | 简单Loading图标 |
| B组 | 铜钱旋转动画 + "AI正在解卦中..." |

#### 核心指标
- **主要指标**: 等待阶段流失率
- **次要指标**: 整体完成率、会话时长

#### 成功标准
- B组流失率显著低于A组
- 完成率提升至少5%

---

### 实验3: 结果展示形式优化

#### 背景
当前AI回答直接展示全文，用户可能感觉信息过载。

#### 假设
分段展示 + 关键信息高亮能提升用户满意度。

#### 实验设计
| 组别 | 方案 |
|------|------|
| A组 | 纯文本展示 |
| B组 | 分段折叠 + 关键信息高亮 + 摘要卡片 |

#### 核心指标
- **主要指标**: 满意度评分
- **次要指标**: 分享率、保存率

---

## 4. 技术实现方案

### 4.1 分流逻辑

```javascript
// 基于user_id的哈希分流
function assignExperimentGroup(userId, experimentId) {
    // 生成哈希值
    const hash = md5(userId + experimentId);
    const hashInt = parseInt(hash.substring(0, 8), 16);
    
    // 50:50分流
    return hashInt % 2 === 0 ? 'A' : 'B';
}

// 使用示例
const group = assignExperimentGroup(user.id, 'prompt_v2_test');
const prompt = group === 'A' ? promptV1 : promptV2;
```

### 4.2 数据标记

```javascript
// 在埋点中标记实验分组
Analytics.trackEvent('experiment', 'assignment', {
    experiment_id: 'prompt_v2_test',
    group: 'A', // 或 'B'
    user_id: user.id
});
```

### 4.3 实验配置管理

```javascript
// experiments.config.js
const EXPERIMENTS = {
    'prompt_v2_test': {
        name: 'Prompt优化测试',
        startDate: '2026-02-10',
        endDate: '2026-02-24',
        trafficSplit: { A: 0.5, B: 0.5 },
        primaryMetric: 'follow_up_rate',
        targetLift: -0.10 // 降低10%
    },
    'loading_animation': {
        name: '加载动画测试',
        // ...
    }
};
```

---

## 5. 数据分析方法

### 5.1 统计检验

```python
# 追问率对比 (比例检验)
from scipy import stats

# A组: 1000次对话，350次追问
# B组: 1000次对话，280次追问

count = [350, 280]
nobs = [1000, 1000]

z_stat, p_value = stats.proportions_ztest(count, nobs)

if p_value < 0.05:
    print(f"差异显著 (p={p_value:.4f})")
else:
    print(f"差异不显著 (p={p_value:.4f})")
```

### 5.2 置信区间计算

```python
import numpy as np
from scipy import stats

# 计算转化率差异的95%置信区间
def conversion_rate_ci(success_a, n_a, success_b, n_b, confidence=0.95):
    rate_a = success_a / n_a
    rate_b = success_b / n_b
    
    se = np.sqrt(rate_a*(1-rate_a)/n_a + rate_b*(1-rate_b)/n_b)
    z = stats.norm.ppf((1 + confidence) / 2)
    
    diff = rate_b - rate_a
    ci_low = diff - z * se
    ci_high = diff + z * se
    
    return diff, ci_low, ci_high

# 使用
diff, low, high = conversion_rate_ci(350, 1000, 280, 1000)
print(f"差异: {diff:.2%}, 95%CI: [{low:.2%}, {high:.2%}]")
```

### 5.3 实验结果解读

| 结果 | p值 | 置信区间 | 结论 |
|------|-----|---------|------|
| 显著提升 | <0.05 | 不包含0 | 上线实验组方案 |
| 显著下降 | <0.05 | 不包含0 | 保持对照组方案 |
| 无显著差异 | >0.05 | 包含0 | 结合业务判断 |

---

## 6. 实验结果模板

```markdown
## 实验结果报告 - [实验名称]

### 1. 实验概况
- 实验ID: 
- 实验周期: 2026-02-10 ~ 2026-02-24
- 样本量: A组150人，B组152人

### 2. 核心指标结果

| 指标 | A组(对照) | B组(实验) | 差异 | p值 | 结论 |
|------|----------|----------|------|-----|------|
| 追问率 | 35.3% | 18.4% | -16.9% | <0.001 | 显著降低 |
| 满意度 | 3.8/5 | 4.3/5 | +0.5 | <0.01 | 显著提升 |
| 响应时间 | 1.2s | 1.3s | +0.1s | 0.34 | 无显著差异 |

### 3. 统计结论
- 主要指标(追问率)显著降低，p < 0.001
- 95%置信区间: [-23.4%, -10.4%]
- 实验假设验证成功

### 4. 业务结论
v2.0 Prompt显著优于v1.0，建议全量上线。

### 5. 后续计划
- 全量上线v2.0 Prompt
- 继续优化v3.0版本
- 监控长期效果
```

---

## 7. 常见误区与建议

### 7.1 常见误区

| 误区 | 说明 | 正确做法 |
|------|------|---------|
| **样本不足** | 只看绝对数值，忽视统计显著性 | 计算所需样本量，达到再分析 |
| **过早下结论** | 实验刚跑1天就看结果 | 至少运行2周，避免周期性影响 |
| **多重比较** | 同时看多个指标，凑显著性 | 确定主要指标，控制整体错误率 |
| **忽视护栏** | 只看好指标，忽视风险指标 | 设置护栏指标，触发立即下线 |

### 7.2 最佳实践

✅ **要做的**:
- 实验前明确假设和成功标准
- 计算样本量，避免样本不足
- 设置护栏指标，保护用户体验
- 实验后写复盘文档，积累经验

❌ **不要做的**:
- 实验过程中频繁查看结果（偷看问题）
- 样本不足就下结论
- 一次测试多个变量
- 忽视统计显著性只看绝对值

---

## 8. 实验清单

### 待测试想法池

| 优先级 | 实验想法 | 预期提升 | 难度 |
|--------|---------|---------|------|
| P0 | Prompt增加思维链 | 追问率-10% | 低 |
| P0 | 加载动画优化 | 流失率-5% | 低 |
| P1 | 结果分段展示 | 满意度+10% | 中 |
| P1 | 八字预览优化 | 完成率+5% | 低 |
| P2 | 增加语音播报 | 留存率+5% | 中 |
| P2 | 分享功能优化 | 分享率+20% | 低 |

---

**文档版本**: v1.0  
**撰写**: AI产品实习生  
**最后更新**: 2026年2月
